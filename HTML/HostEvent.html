<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Host an Event | College Alumni Network</title>
  <link rel="stylesheet" href="../CSS/HostEvent.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
</head>
<body>

  <div class="page-container">
    <main class="form-section">
      <div class="card">
        <h1>Host an Event</h1>
        <p class="subtitle">Create memorable campus gatherings for fellow alumni and faculty</p>

        <form id="event-form" class="event-form">

          <div class="form-group">
            <label for="title">Event Title <span class="required">*</span></label>
            <div class="input-wrapper">
              <i class="fa-solid fa-heading"></i>
              <input 
                type="text" 
                id="title" 
                placeholder="e.g. Annual Alumni Cricket Tournament 2026" 
                required
              >
            </div>
          </div>

          <div class="form-row">
            <div class="form-group half">
              <label for="category">Event Category <span class="required">*</span></label>
              <div class="input-wrapper select-wrapper">
                <i class="fa-solid fa-list-ul"></i>
                <select id="category" required>
                  <option value="" disabled selected>Select category</option>
                  <option value="reunion">Reunion / Batch Meet</option>
                  <option value="cultural">Cultural / Fest</option>
                  <option value="sports">Sports</option>
                  <option value="seminar">Seminar / Workshop</option>
                  <option value="career">Career Guidance / Talk</option>
                  <option value="social">Social / Charity</option>
                  <option value="other">Other</option>
                </select>
              </div>
            </div>

            <div class="form-group half">
              <label for="max-participants">Maximum Participants <span class="required">*</span></label>
              <div class="input-wrapper">
                <i class="fa-solid fa-users"></i>
                <input 
                  type="number" 
                  id="max-participants" 
                  min="1" 
                  placeholder="e.g. 120" 
                  required
                >
              </div>
            </div>
          </div>

          <div class="form-group">
            <label for="description">Event Description <span class="required">*</span></label>
            <textarea 
              id="description" 
              rows="6" 
              placeholder="Tell alumni what the event is about, who should attend, what to expect..." 
              required
            ></textarea>
          </div>

          <div class="form-row">
            <div class="form-group half">
              <label for="event-date">Event Date & Time <span class="required">*</span></label>
              <div class="input-wrapper">
                <i class="fa-solid fa-calendar-days"></i>
                <input 
                  type="datetime-local" 
                  id="event-date" 
                  required
                >
              </div>
            </div>

            <div class="form-group half">
              <label for="registration-closing">Registration Closes <span class="required">*</span></label>
              <div class="input-wrapper">
                <i class="fa-solid fa-clock"></i>
                <input 
                  type="datetime-local" 
                  id="registration-closing" 
                  required
                >
              </div>
            </div>
          </div>

          <div class="form-group">
            <label for="location">Event Location</label>
            <div class="input-wrapper">
              <i class="fa-solid fa-location-dot"></i>
              <input 
                type="text" 
                id="location"
                placeholder="e.g. Main Auditorium, Holkar Science College"
                value="Main Campus, Holkar Science College"
              >
            </div>
          </div>

          <div class="form-group">
            <label for="banner-url">Event Banner Image URL</label>
            <div class="input-wrapper">
              <i class="fa-solid fa-image"></i>
              <input 
                type="url" 
                id="banner-url" 
                placeholder="https://example.com/my-event-banner.jpg"
              >
            </div>
            <small class="help-text">
              Paste a direct image link (recommended 1200×600 px). File upload coming soon.
            </small>
          </div>

          <div id="form-message" class="form-message hidden"></div>

          <button type="submit" class="btn-submit" id="submit-btn">
            <span class="btn-text">Publish Event</span>
            <span class="btn-loading hidden">Publishing...</span>
          </button>

        </form>
      </div>
    </main>
  </div>

  <!-- ============================================= -->
  <!--               SCRIPTS                         -->
  <!-- ============================================= -->

  <!-- Firebase SDKs -->
  <script src="https://www.gstatic.com/firebasejs/10.14.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.14.1/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.14.1/firebase-firestore-compat.js"></script>

  <!-- Firebase Initialization -->
  <script src="../JavaScript/firebase-init.js"></script>

  <!-- Page Protection -->
  <script src="../JavaScript/auth-protect.js"></script>

  <!-- Event Creation Logic -->
  <script>
    const eventForm = document.getElementById('event-form');
    const submitBtn = document.getElementById('submit-btn');
    const btnText = submitBtn.querySelector('.btn-text');
    const btnLoading = submitBtn.querySelector('.btn-loading');
    const messageEl = document.getElementById('form-message');

    function showMessage(text, isError = false) {
      messageEl.textContent = text;
      messageEl.classList.remove('hidden', 'success', 'error');
      messageEl.classList.add(isError ? 'error' : 'success');
    }

    function resetButton() {
      submitBtn.disabled = false;
      btnText.classList.remove('hidden');
      btnLoading.classList.add('hidden');
    }

    eventForm.addEventListener('submit', async (e) => {
      e.preventDefault();

      // Basic validation (beyond HTML required)
      const title = document.getElementById('title').value.trim();
      const category = document.getElementById('category').value;
      const maxParticipants = parseInt(document.getElementById('max-participants').value);
      const description = document.getElementById('description').value.trim();
      const eventDate = document.getElementById('event-date').value;
      const registrationClosing = document.getElementById('registration-closing').value;
      const location = document.getElementById('location').value.trim();
      const bannerUrl = document.getElementById('banner-url').value.trim();

      if (!title || !category || !description || !eventDate || !registrationClosing) {
        showMessage("Please fill all required fields.", true);
        return;
      }

      if (maxParticipants < 1) {
        showMessage("Maximum participants must be at least 1.", true);
        return;
      }

      if (new Date(registrationClosing) >= new Date(eventDate)) {
        showMessage("Registration closing time must be before event start time.", true);
        return;
      }

      // Prepare data
      const eventData = {
        title,
        category,
        maxParticipants,
        currentParticipants: 0,
        description,
        eventDate: firebase.firestore.Timestamp.fromDate(new Date(eventDate)),
        registrationClosing: firebase.firestore.Timestamp.fromDate(new Date(registrationClosing)),
        location: location || "Main Campus, Holkar Science College",
        bannerUrl: bannerUrl || null,
        createdBy: auth.currentUser.uid,
        createdByEmail: auth.currentUser.email,
        createdAt: firebase.firestore.FieldValue.serverTimestamp(),
        status: "upcoming"   // can be upcoming, ongoing, completed later
      };

      // UI feedback
      submitBtn.disabled = true;
      btnText.classList.add('hidden');
      btnLoading.classList.remove('hidden');
      showMessage("Publishing event...");

      try {
        await db.collection('events').add(eventData);

        showMessage("Event published successfully! ✓", false);
        
        // Reset form
        eventForm.reset();
        
        // Redirect after 2 seconds
        setTimeout(() => {
          window.location.href = "home.html";
        }, 1800);

      } catch (error) {
        console.error("Error creating event:", error);
        showMessage("Failed to publish event: " + error.message, true);
        resetButton();
      }
    });
  </script>
</body>
</html>